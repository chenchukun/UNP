## 非阻塞式I/O

​	套接字的默认状态是阻塞的，通过设置O_NONBLOCK标志可以将套接字设置为非阻塞模式。

### 可能阻塞的调用

#### 读操作

​	对一个阻塞式的套接字调用读操作，包括read、read、recv、recvfrom和recvmsg共5个函数，当该套接字的接收缓冲区中没有数据可读时，将一直阻塞，直到数据到达。

​	在非阻塞模式下，如果接收缓冲区没有数据，读操作将立即返回一个EWOULDBLOCK（EAGAIN）错误。

#### 写操作

​	对一个阻塞式的套接字调用写操作，包括write、writev、send、sendto、sendmsg共五个函数，当套接字的发送缓冲区没有空间时，写调用将一直阻塞，直到发送缓冲区有空间。

​	在非阻塞模式下，若发送缓冲区没有空间，写操作将立即返回一个EWOULDBLOCK（EAGAIN）错误。若发送缓冲区有一些空间，返回值将是内核能够复制到该缓冲区中的字节数，这个字节数也称为不足计数。

#### 接收连接

​	对一个阻塞式的套接字调用accept函数，在尚无连接连接到达时，将一直阻塞，直到有新连接到达。

​	在非阻塞模式下，若尚无新的连接到达，accept调用将立即返回一个EWOULDBLOCK（EAGAIN）错误。

#### 发起链接

​	在阻塞模式下，调用connect发起连接将开始三次握手的过程，connect函数将一直等到服务器对自己发送的SYNC响应的ACK才返回，这意味着TCP的每个connect总会阻塞其调用进程至少一个到服务器的RTT时间。

​	对于一个非阻塞的TCP套接字调用connect，当连接不能立即建立时，系统将照样发起三次握手，并立即返回一个EINPROGRESS错误。某些情况下connect能够立即连接连接，这种情况通常发生在服务端和客户端在同一台主机上，因此应该注意处理这种情况。

​	